<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>진로 성향 테스트</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 20px; max-width: 700px; margin: auto; background-color: #f7f7f7; color: #333; }
    .question { margin-bottom: 20px; }
    .choices button { display: block; margin: 5px 0; padding: 10px; width: 100%; border: none; background-color: #e0e0e0; cursor: pointer; border-radius: 6px; }
    .choices button:hover { background-color: #c0c0c0; }
    .result, .feedback { margin-top: 30px; background-color: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .hidden { display: none; }
    .button-group button { margin-right: 10px; padding: 8px 12px; border: none; background-color: #4caf50; color: white; border-radius: 5px; cursor: pointer; }
    .button-group button:hover { background-color: #388e3c; }
  </style>
</head>
<body>
  <h1>진로 성향 테스트</h1>
  <div id="quiz"></div>
  <div class="result hidden" id="result"></div>
  <div class="feedback hidden" id="feedback">
    <p>이 테스트가 유익했나요?</p>
    <div class="button-group">
      <button onclick="recordFeedback('yes')">네</button>
      <button onclick="recordFeedback('no')">아니오</button>
    </div>
    <p id="thanksMsg" style="margin-top: 15px;"></p>
  </div>

  <script>
    const apiKey = "YOUR_OPENAI_API_KEY"; // ← 반드시 서버 측에서 관리할 것

    const questions = [
      "1. 어떤 문제 상황에서…", "2. 복잡한 환경에서…", "3. 협업할 때 네 경향은…", "4. 결정이 필요한 순간…",
      "5. 여러 선택지 중 하나를 택할 때…", "6. 많은 정보가 들어올 때…", "7. 사람들과 관계를 맺을 때…",
      "8. 무언가에 집중하려 할 때…", "9. 팀 내 역할이 주어질 때…", "10. 중요한 발표를 앞두었을 때…",
      "11. 실수가 반복될 때…", "12. 목표가 모호한 일을 맡을 때…", "13. 감정이 앞설 때 네 반응은…",
      "14. 일정이 빠듯한 프로젝트에서…", "15. 처음 보는 환경에서 적응할 때…", "16. 무기력할 때의 반응은…",
      "17. 예상과 다른 결과가 나왔을 때…", "18. 계획이 틀어졌을 때…", "19. 새로운 기술을 배울 때…",
      "20. 다른 사람과 갈등이 생겼을 때…"
    ];

    const options = [
      ["① 빠르게 해결해보려 하지만 불안감이 생김", "② 잠시 멈추고 상황을 이해하려 하나 마음이 조급함", "③ 다른 사람의 의견을 듣지만 결론을 내리기 어렵다"],
      ["① 시끄럽지만 일단 처리해보려 함", "② 그냥 내 방식대로 밀고 나감", "③ 다양한 정보를 받아들이지만 머리가 복잡해짐"],
      ["① 리더로 나서나 내심 부담됨", "② 아이디어는 내지만 실행은 피하고 싶음", "③ 정리하길 원하나 실제로는 흐름에 맡김"],
      ["① 빠르게 결정하고 후회함", "② 그냥 감으로 정하지만 찝찝함", "③ 미루다 시간이 지나 결정됨"],
      ["① 고민하다 아무거나 선택함", "② 분석하다가 오히려 불안해짐", "③ 다른 사람이 정해주면 오히려 편함"],
      ["① 정리하려 하지만 정리가 안 됨", "② 감정에 따라 수용이 달라짐", "③ 멍하게 바라보다가 흘려보냄"],
      ["① 친해지고 싶지만 피곤함", "② 거리두고 싶지만 죄책감이 듦", "③ 자연스럽게 대하지만 마음은 복잡함"],
      ["① 빠르게 몰입하지만 금방 지침", "② 환경에 민감하게 반응함", "③ 쉽게 산만해짐"],
      ["① 정해진 대로 하려다 지루해짐", "② 창의적으로 하려다 충돌함", "③ 그냥 적응하지만 내 의견은 안 냄"],
      ["① 떨리지만 준비만 하다 시간 지남", "② 발표하나 내심 회피하고 싶음", "③ 남의 눈치 보며 버틴다"],
      ["① 책임감 느끼지만 짜증남", "② 대충 넘기려다 더 실수함", "③ 회피하고 싶다"],
      ["① 목표 정하려다 귀찮음", "② 일단 시작하나 중간에 놓침", "③ 아무 생각 없이 하다 방향 잃음"],
      ["① 감정 폭발 후 후회함", "② 억누르다 병남", "③ 적당히 표현하지만 남 탓함"],
      ["① 무조건 해보지만 지침", "② 순서대로 하려다 망함", "③ 중간중간 방향이 바뀜"],
      ["① 무난히 하려다 존재감 없음", "② 튀려다 부담됨", "③ 그냥 그 자리에 있음"],
      ["① 참고 넘기려다 더 지침", "② 말없이 고립됨", "③ 억지로 텐션 높임"],
      ["① 다시 해보려 하지만 확신 없음", "② 원인 분석하려다 피로함", "③ 그냥 흘려보냄"],
      ["① 다시 계획 세우지만 의욕 없음", "② 우선순위 정하다 방향을 잃음", "③ 즉흥적으로 다시 시작함"],
      ["① 자료만 모으다 끝남", "② 배워보지만 쉽게 포기함", "③ 옆에서 알려줘야 이해됨"],
      ["① 참다 폭발함", "② 조용히 피함", "③ 무시하거나 타협함"]
    ];

    const traitsMap = {
      '1-1': '문제해결', '1-2': '자기성찰', '1-3': '우유부단',
      '2-1': '처리집중', '2-2': '고집', '2-3': '혼란수용',
      // 계속 추가 필요
    };

    let currentQuestion = 0;
    let answers = [];

    const quiz = document.getElementById("quiz");
    const result = document.getElementById("result");
    const feedback = document.getElementById("feedback");
    const thanksMsg = document.getElementById("thanksMsg");

    function showQuestion() {
      if (currentQuestion >= questions.length) {
        showResult();
        return;
      }
      const q = document.createElement("div");
      q.className = "question";
      q.innerHTML = `<h3>${questions[currentQuestion]}</h3>`;

      const choiceDiv = document.createElement("div");
      choiceDiv.className = "choices";
      options[currentQuestion].forEach((opt, idx) => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => {
          answers.push(`${currentQuestion + 1}-${idx + 1}`);
          quiz.innerHTML = "";
          currentQuestion++;
          showQuestion();
        };
        choiceDiv.appendChild(btn);
      });
      q.appendChild(choiceDiv);
      quiz.appendChild(q);
    }

    async function showResult() {
      quiz.classList.add("hidden");
      result.classList.remove("hidden");
      feedback.classList.remove("hidden");

      const traitsList = answers.map(key => traitsMap[key] || key).join(', ');

      const prompt = `사용자의 진로 성향 테스트 결과입니다. 각 항목은 사용자가 선택한 성향을 나타냅니다:\n${traitsList}\n이 성향들을 바탕으로 다음 항목에 대해 분석해주세요:\n1. 사용자의 전반적인 성격적 경향과 사고 방식\n2. 성격상의 강점과 약점\n3. 사회적, 직업적 관계에서 나타날 수 있는 특징\n4. 추천할 수 있는 진로 유형 3가지 이상\n5. 그 이유\n응답은 최대한 구체적이고 상세하게 작성해주세요.`;

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: "gpt-4",
          messages: [{ role: "user", content: prompt }],
          temperature: 0.7
        })
      });

      const data = await response.json();

      result.innerHTML = `
        <h2>🎯 테스트 완료</h2>
        <p><strong>성향 요약:</strong> ${traitsList}</p>
        <hr />
        <h3>🧭 GPT 분석 결과</h3>
        <pre style="white-space: pre-wrap;">${data.choices[0].message.content}</pre>
      `;
    }

    function recordFeedback(choice) {
      thanksMsg.textContent = `의견 감사합니다. (${choice === 'yes' ? '유익했음' : '유익하지 않음'})`;
    }

    showQuestion();
  </script>
</body>
</html>
